<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guidance Robot - Home</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <header class="header">Sentry Scout</header>
    <main class="main">
        <div>
            <h2>Select Destination:</h2>
            <div id="goalpost" style="width: 500px; height: 500px; background-color: #eee; position: relative;">
                <img src="/static/images/goalpost.png" alt="Goalpost" style="width: 100%; height: 100%;"/>
                <div id="destination-indicator" style="position: absolute; background-color: red; width: 10px; height: 10px; border-radius: 50%; display: none;"></div>
            </div>
            <p id="coordinates-display">No destination selected</p>
        </div>
        <button id="send-destination-btn" class="speak-btn">Send Destination</button>
        <button id="mic-btn">
            <img src="/static/images/mic.png" alt="Mic Icon">
            <span>Touch to Speak</span>
        </button>
        
        
    </main>
    <footer class="footer">Status: Updates Here</footer>

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io.connect('http://localhost:5000');
        const destinationIndicator = document.getElementById("destination-indicator");
        const coordinatesDisplay = document.getElementById("coordinates-display");

        // Function to handle map clicks and fetch coordinates
        document.getElementById('goalpost').addEventListener('click', function(event) {
            const goalpostRect = event.target.getBoundingClientRect();
            const clickX = event.clientX - goalpostRect.left; // Relative X
            const clickY = event.clientY - goalpostRect.top;  // Relative Y

            // Show the destination indicator on the map
            destinationIndicator.style.left = `${clickX - 5}px`;  // Adjust to center the dot
            destinationIndicator.style.top = `${clickY - 5}px`;   // Adjust to center the dot
            destinationIndicator.style.display = "block";

            // Display the coordinates on the page
            coordinatesDisplay.textContent = `Destination: X=${clickX}, Y=${clickY}`;

            // Send the coordinates to the backend via WebSocket
            socket.emit('send_destination', { x: clickX, y: clickY });
        });

    // Listen for the backend acknowledgment
    socket.on('destination_received', (data) => {
        console.log(data.message);  // Logs the confirmation message
        alert(data.message);        // Shows an alert with the confirmation message
    });


        // Create a display area for transcription
    const transcriptionDisplay = document.createElement("p");
    transcriptionDisplay.id = "transcription-display";
    transcriptionDisplay.style.position = "fixed";
    transcriptionDisplay.style.bottom = "80px";
    transcriptionDisplay.style.right = "20px";
    transcriptionDisplay.style.background = "rgba(0,0,0,0.7)";
    transcriptionDisplay.style.color = "white";
    transcriptionDisplay.style.padding = "10px";
    transcriptionDisplay.style.borderRadius = "5px";
    transcriptionDisplay.style.display = "none";  // Initially hidden
    document.body.appendChild(transcriptionDisplay);

    document.getElementById("mic-btn").addEventListener("click", function() {
    console.log("Voice button clicked, starting recording...");
    transcriptionDisplay.innerText = "Listening... üé§"; // Show listening status
    transcriptionDisplay.style.display = "block";  // Make it visible
    socket.emit("start_recording"); // Send event to start speech recognition
});

    socket.on("transcription_result", function(data) {
        console.log("Received transcription:", data); // Debugging
    if (data.transcription && data.transcription.trim() !== "") {
        transcriptionDisplay.innerText = "You said: " + data.transcription;
    } else {
        transcriptionDisplay.innerText = "No speech detected ‚ùå";
    }
});
    </script>
</body>
</html>
